# 项目课程


## 第一课七彩灯

1.1 项目介绍：

![](media/d611b97a4d7d3bb26f373deb10aed2c4.png)首先我们要来完成经典的“Arduino点亮LED”，但是我们这里的LED，不是普通的单色LED，而是一个7彩LED，它采用7彩自动闪烁LED（外观白色，显示七彩）元件。7色LED模块可自动闪烁内置颜色。可以用来制作相当迷人的灯光效果。这个模块与普通LED驱动相同，当我们给它输入高电平时将自动闪烁七种颜色，而输入低电平时将停止闪烁。

我们已经将7彩LED集成到了我们的电机驱动底板，在第一个项目中，我们用一个最基本的测试代码来控制这个七彩LED，让它闪烁3秒钟，灭一秒钟，来实现控制的效果。你也可以改变代码中LED灯亮灭的时间，实现不同的闪烁时长效果。LED模块信号端S为高电平时7彩LED开始自动闪烁，S为低电平时七彩LED熄灭不再闪烁。

1.2 模块相关资料：

![](media/98d8992440974c7f5918c3e05f2da097.png)

![](media/2dfdc4dc411297bb863ef53217528fbc.png)

两个七彩灯分别通过三极管来控制，信号端分别接到了P5.4和P5.5，所以我们只要控制这两个引脚输出高低电平即可控制两个七彩灯。

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/4ee49f93f40ed2b155bfd718d7cc975d.png)

2.  ![](media/5d367e654e213aabb900c4c3acc5984f.png)

3.  ![](media/b8424a7c661281c6f7facfc1493fa63d.png)

4.  ![](media/734fe4357c69061b544ea891f487e918.png)

1.3.2.完整的代码程序：

![](media/99709f414ff7837a3557f2406b15dca8.png)

1.4 实验结果：

编译上传代码完成后，将拨码开关拨到ON端上电，我们就可以看到底板的2个七彩LED闪烁3秒然后熄灭1秒，然后再次闪烁3秒再熄灭1秒，如此反复循环。





## 第二课 WS2812 RGB灯

1.1 项目介绍：

![](media/d1430e7b98db55d29eadb7e9ef16810e.jpg)在第一个项目，我们详细的介绍了通过代码控制七彩LED控制闪烁。这节课我们使用WS2812灯珠来显示真正的多彩灯，理论上我们可以通过编程实现我们想要显示的任意的颜色。

但是这个2812 RGB
驱动原理与我们前面学习过的七彩LED不相同，但是也只需要一个引脚就能控制，这是一个集控制电路与发光电路于一体的智能外控LED光源。每个LED原件其外型与一个5050LED灯珠相同，每个元件即为一个像素点，我们这个电机驱动板上有四个灯珠即四个像素。下面我们来学习如何控制它来显示任意颜色。

1.2 模块相关资料：

![](media/2fddc64a4a71932e4830248c1d6d778c.png)

这四个像素点灯珠都是串联起来的，其实不论多少个，我们都可以用一个引脚（我们这里接的D10）控制任意一个灯，并且让它显示任一种颜色。像素点内部包含了智能数字接口数据锁存信号整形放大驱动电路，还包含有高精度的内部振荡器和12V高压可编程定电流控制部分，有效保证了像素点光的颜色高度一致。数据协议采用单线归零码的通讯方式，像素点在上电复位以后，S端接受从控制器传输过来的数据，首先送过来的24bit数据被第一个像素点提取后，送到像素点内部的数据锁存器。这个2812RGB通讯协议与驱动已经在底层封装好了，我们直接调用函数的接口就可以使用。

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/2ae8bf85ec366d345e4b998c25ae7404.png)

2.  ![](media/d7cfcd0d82e5cf2349c142d104a6bf1e.png)

1.3.2.完整的代码程序：

![](media/eab9326f5b9745c14a33f0a3f589c9a4.png)

1.4 实验结果：

将拨码开关拨到ON端上电，上传代码完成，我们就可以看到底板的4个2812灯珠分显示红、绿、蓝、白色。

1.5 项目拓展： 流水彩灯

1.5.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/2ae8bf85ec366d345e4b998c25ae7404.png)

2.  ![](media/97ec282c687d868b52a0f2996194d4a7.png)



3.  ![](media/d7cfcd0d82e5cf2349c142d104a6bf1e.png)

4.  ![](media/fe8462b884dd275e6b48c0287e5f9e68.png)

5.  ![](media/6b2dacd69fc80c735a39f6fecd887c4a.png)

1.5.2.完整的代码程序：

![](media/7da1350ca15770940b31269a1194fb9b.png)

上传代码成功后，我们将看到4个灯珠以随机颜色显示流水灯。





## 第三课 伺服舵机

1.1 项目介绍：

![](media/d10643b01e46fb947581bb4bc22dea20.png)对于那些DIY智能汽车来说，往往都有自动避障的功能。在DIY过程中，我们需要一个伺服来控制超声波模块左右旋转，然后检测汽车与障碍物的距离，从而控制汽车避开障碍物。
如果使用其他微控制器来控制伺服的旋转，我们需要设置一定频率和一定宽度的脉冲来控制伺服角度。但是如果用arduino来控制伺服角度，我们只需要在开发环境中设置舵机的连接引脚然后设置控制角度即可。在开发环境中会自动设置相应的脉冲来控制伺服旋转。
在本项目中，您将学习如何控制伺服舵机在0°和180°之间来回旋转。

1.2 模块相关资料：

角度范围：0°~180°（有0°~360°舵机，0°~180°舵机，0°~90°舵机）

驱动电压：3.3V或5V

引脚一般为三根线

![](media/4b15604cd8a82aeb39497c7544b39f93.emf)

GND：一个接地的引脚，棕色

VCC：一个连接到+5v（3.3V）电源的引脚，红色

S：信号端的引脚，PWM信号控制，橙色（我们这里接到了D9）

控制原理：舵机的转动的角度是通过调节PWM（脉冲宽度调制）信号的占空比来实现的，标准PWM（脉冲宽度调制）信号的周期固定为20ms（50Hz），理论上脉宽分布应在1ms到2ms
之间。

![](media/9958a9613f2526d0a96dd857b21d6310.png)

但是，事实上脉宽可由0.5ms 到2.5ms
之间，脉宽和舵机的转角0°～180°相对应。有一点值得注意的地方，由于舵机牌子不同，对于同一信号，不同牌子的舵机旋转的角度也会有所不同。

![](media/4e9f169725398e11aba1bff347897339.png)

经过实测，舵机的脉冲范围为0.65ms~2.5ms。180度舵机，对应的控制关系是这样的：

<table>
<colgroup>
<col />
<col />
<col />
</colgroup>
<tbody>
<tr>
<td>高电平时间</td>
<td>舵机角度</td>
<td>基准信号周期时间（20ms）</td>
</tr>
<tr>
<td>0.65ms</td>
<td>0度</td>
<td>0.65ms高电平+19.35ms低电平</td>
</tr>
<tr>
<td>1.5ms</td>
<td>90度</td>
<td>1.5ms高电平+18.5ms低电平</td>
</tr>
<tr>
<td>2.5ms</td>
<td>180度</td>
<td>2.5ms高电平+17.5ms低电平</td>
</tr>
</tbody>
</table>

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/5d237db1d45568d77a86238f5eec8b19.png)

2.  ![](media/a5a73617490a108dc89c7ab8a2b416ac.png)

3.  ![](media/be3eed56d7f162cd3132380a1c2f6ea4.png)

4.  ![](media/6c18f7e3dcc2eb12999a990cf92d7063.png)

1.3.2.完整的代码程序：

![](media/d95fa0ab7e6361b7414b127103da4635.png)

1.4 实验结果：

编译上传代码完成后，将拨码开关拨到ON端上电，我们就可以看到舵机从0度到180度之间来回转动了。





## 第四课 直流减速电机

1.1 项目介绍：

![](media/ee3eba2127f8b2607d91f1c7da36f12d.png)要想让小车跑起来那必须要有电机，然后搭配车轮就可以了。我们这个套件上配有4个直流减速电机，即[齿轮减速电机](https://baike.baidu.com/item/%E9%BD%BF%E8%BD%AE%E5%87%8F%E9%80%9F%E7%94%B5%E6%9C%BA/3249233)，是在普通[直流电机](https://baike.baidu.com/item/%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA/2404223)的基础上，加上配套齿轮减速箱。齿轮减速箱的作用是，提供较低的转速，较大的力矩。同时，[齿轮箱](https://baike.baidu.com/item/%E9%BD%BF%E8%BD%AE%E7%AE%B1/1059341)不同的[减速比](https://baike.baidu.com/item/%E5%87%8F%E9%80%9F%E6%AF%94/5341327)可以提供不同的转速和力矩。这大大提高了直流电机在自动化行业中的使用率，[减速电机](https://baike.baidu.com/item/%E5%87%8F%E9%80%9F%E7%94%B5%E6%9C%BA/3750851)是指[减速机](https://baike.baidu.com/item/%E5%87%8F%E9%80%9F%E6%9C%BA/873618)和电机（马达）的集成体，这种集成体通常也可称为[齿轮马达](https://baike.baidu.com/item/%E9%BD%BF%E8%BD%AE%E9%A9%AC%E8%BE%BE/7911602)或[齿轮电机](https://baike.baidu.com/item/%E9%BD%BF%E8%BD%AE%E7%94%B5%E6%9C%BA/3377578)。减速电机广泛应用于钢铁行业、机械行业等。使用减速电机的优点是简化设计、节省空间。

电机的驱动不比LED，它要求的电流比较大，如果我们使用IO口强制驱动电机，要么电机不转动，要么烧坏单片机，所以我们需要一个电机驱动芯片。在电机驱动底板板上已经包含了DRV8833电机驱动芯片，用来控制4个直流减速电机的转动方向和转动速度。我们下面来看一下电机驱动底板两个芯片的电路原理图：

1.2 模块相关资料：

![](media/ff4495f197508b2b161000b37f4a7ede.png)

![](media/3ae4d36064af4182156ceb7938e8f094.png)

每个芯片控制4个引脚，每两个引脚控制一个电机，这样就使用了8个引脚控制了4个电机了。我们可以看到电机驱动与STC的接线图，我们驱动电机的时候使用IIC协议往STC这个芯片对应的寄存器地址写入脉宽值就可以输出pwm信号给电机驱动芯片了，我们已经写好了电机驱动的库文件，我们使用的时候只需要调用API函数就可以让小车走了，非常简单。

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/6a5c112f52d5790dfd295174e2dac678.png)

2.  ![](media/79c8863ccb28dfb336820bd82c38add2.png)

3.  ![](media/c9fbb001e72b2c18f4f0483bce8b025e.png)

4.  ![](media/f232dc8177c3a8ccb16dec5692546b86.png)

1.3.2.完整的代码程序：

![](media/30f607c155b21dd16e8a9a7368c62645.png)

1.4 实验结果：

编译上传代码完成后，将拨码开关拨到ON端上电，我们就可以看到小车前进2秒，后退2秒，左转2秒，右转2秒，最后停止1秒，如此反复循环。





## 第五课 循迹传感器

1.1 项目介绍：

![](media/031a1a93362b8aad7bcb3662b5d87609.png)巡线传感器实际上是红外传感器。
在小车驱动底板的前面有3路巡线，此处使用的组件是TCRT5000红外灯管。
其工作原理是利用红外光对颜色的不同反射率，然后将反射信号的强度转换为电流信号。
在检测过程中，黑色在高电平时处于活动状态，而白色在低电平时处于活动状态，即检测到黑色时或者近距离没有检测到物体时输出高电平，检测到白色或者光滑易反射光的物体时输出低电平。
检测高度为0-3厘米。
底板上方还有3个蓝色旋转电位器，通过旋转这些电位器，可以调节传感器的检测灵敏度。

1.2 模块相关资料：

工作电压: 3.3-5V (DC)

接口: 5PIN接口(我们接到了A0,A1,A2)

输出信号:
数字信号（模拟信号口也可以当数字信号用，A0相当于D13，A1相当于D14，以此类推。）

检测高度: 0-3 cm

原理：巡线传传感器的原理是利用红外线对颜色的反射率不一样，将反射信号的强弱转化成电流信号。上电时，发射二极管发射红外光，FB-为电位器，我们通过调整电位器给电压比较器LM339D的4、6、8脚提供一个阈值电压，这个电压值的大小可以根据实际情况来调试确定。而红外光敏二极管收到红外光的时候，会产生电流，并且随着红外光的从弱变强，电流会从小变大。当没有红外光或者说红外光很弱的时候，输出的信号接近VCC，通过LM339D比较器后，接收检测引脚输出一个高电平。当随着光强变大，电流变大，输出电压就会越来越小，当小到一定程度，接收检测引脚就会变为低电平。当红外信号发送到黑色轨道时，黑色因为吸光能力比较强，红外信号发送出去后就会被吸收掉，反射部分很微弱。白色轨道就会把大部分红外信号反射回来。也就是说检测到黑色或没检测到物体时，单片机信号端接收到高电平；检测到白色物体时，单片机信号端接收到低电平。

![](media/8e0808b818896309a4ec99642ef5f543.png)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/01840d65b8d8fe70cf9e256def8bae39.png)

2.  ![](media/25c0d870899a3ad8c1e8f6d276870aa8.png)

3.  ![](media/d461702129ef408c7efca29d14e019c3.png)

4.  ![](media/6134304ce19e7bd1d501d61f3be2b7ea.png)

5.  ![](media/697309a4e3e470cce6465c58d1dd9d44.png)

1.3.2.完整的代码程序：

![](media/0fc9974bc28776529a5c2820af821b82.png)

1.4 实验结果：

编译上传代码完成后，将拨码开关拨到ON端上电，在串口监视器窗口点击

![](media/257ee5b45ba345f89476b9536b00f888.png)

设置波特率为9600，我们可以看到在串口监视器是上打印的三路巡线传感器接收到的数字信号，当我们用白纸去遮挡它的时候，输出0，用黑纸或者悬空小车的时候，输出1：

![](media/9b32236194a34d694a51273159aca536.png)





## 第六课 循迹智能车

![](media/2cbed09c1cb317585d89c447ad7c4cf1.jpg)

1.1 项目介绍：

前面我们学习了循迹传感器和电机驱动的原理和应用，下面我们要结合这两个基本的循迹传感器和电机驱动来做一款循迹小车。

循迹，意思就是循着轨迹，也就是我们经常会看到的走黑线的循迹小车，原理是利用循迹传感器对路面黑色轨迹进行检测，并将路面检测信号反馈给控制主板。控制板对采集到的信号予以分析判断，及时控制驱动电机以调整小车转向，从而使小车能够沿着黑色轨迹自动行驶，实现循迹小车自动寻迹的目的，我们来看看下面的流程图就清晰了：

1.2 实验流程图：

![](media/900efa189803f0602b01f5fd172bb54c.emf)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/bd27f64d14fe041a649606a323136398.png)

2.  ![](media/d82be8dfc9352f563c0ad80a59d436dc.png)

3.  ![](media/687ff3e62e25e9ce0dda4d67f42d5808.png)

4.  ![](media/bc3904838239e4f78ea7a8ee44e5901e.png)

5.  ![](media/ba8d02d7b41e43f42e20baf1f7e82fb9.png)

6.  ![](media/aa31ff0126fb09a529f987623df04168.png)

1.3.2.完整的代码程序：

![](media/c21f15c89205e601a2fc41a50080d90d.png)

![](media/5bc3f44466ff82bfdb6d5afa7200fc67.png)

![](media/b1de72f6ebc33799be14661ef5457a8f.png)

1.4 实验结果：

代码烧录完成后，将拨码开关拨到ON端上电，我们把小车放在黑色循迹图上，小车就能沿着黑线行驶了.





## 第七课 超声波传感器

1.1 项目介绍：

![](media/2d10f5e417b4b7fc28f20d52d6d317ac.png)HC-SR04超声波传感器像蝙蝠一样使用声纳来确定与物体的距离。它在一个易于使用的包装中提供了出色的非接触式范围检测，具有高精度和稳定的读数。它配有超声波发射器和接收器模块。
HC-SR04或超声波传感器正在广泛的电子项目中用于创建障碍物检测和距离测量应用以及各种其他应用。这里介绍了用Keyes UNO PLUS开发板和超声波传感器测量距离的简单方法，以及如何在arduino IDE中使用超声波传感器。

1.2 模块相关参数：

工作电压:+5V DC

静态电流: \<2mA

工作电流: 15mA

有效角度: \<15°

距离范围: 2cm – 400 cm

精度: 0.3 cm

测量角度: 30 degree

触发输入脉宽: 10us

原理：最常用的超声测距的方法是回声探测法，如图，超声波发射器向某一方向发射超声波，在发射时刻的同时计数器开始计时，超声波在空气中传播，途中碰到障碍物面阻挡就立即反射回来，超声波接收器收到反射回的超声波就立即停止计时。超声波也是一种声波，其声速V与温度有关。一般情况下超声波在空气中的传播速度为340m/s，根据计时器记录的时间t，就可以计算出发射点距障碍物面的距离s，即：s=340t/2：

(1)采用IO口TRIG触发测距，给至少10us的高电平信号;

(2)模块自动发送8个40khz的方波，自动检测是否有信号返回；

(3)有信号返回，通过ECHO输出一个高电平，单片机读取到高电平持续的时间就是超声波从发射到返回的时间。



![](media/8a94e0eef2c3055ebb7f1ae0483a1e9b.png)



超声波模块的电路图：

![](media/b573604e96ca595da17452d9b126f2ba.png)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/41ea30eb18039fd6b943938200933a10.png)

2.  ![](media/5c6b0e0a00981ecc0cf756ba08070672.png)

3.  ![](media/9921b1ea4cdb72009025e40829715210.png)

4.  ![](media/e3493c6046374ee35d751e459807350a.png)

5.  ![](media/50eefc27cf9166e7eb99414dd77eab79.png)

6.  ![](media/c205e141236ed99e9038e36650d8de04.png)

1.3.2.完整的代码程序：

![](media/bedfd97a087dd6eb838da98be84c0f45.png)

1.4 实验结果：

编译上传代码成功后上电，在串口监视器窗口点击

![](media/992dc1dc780153cec09beefe5c09c257.png)

设置波特率为9600，我们可以在串口监视器中看超声波模块测得的距离，移动小车前面的障碍物，看到串口监视器中距离值也在发生变化，如下图：

![](media/10925d97e71f3680722ea06e0d16d956.png)





## 第八课 超声波跟随智能车

![](media/f481e2cb24ef18e5045321719c5eda8a.jpg)

1.1 项目介绍：

前面我们学习了使用循迹传感器和电机来制作了一个自动巡线智能小车，这节课我们使用超声波传感器和电机来制作一个自动跟随智能小车，我们通过超声波传感器检测智能车和前方障碍物的距离，然后根据这一个数据控制两个电机的转动，从而控制智能车的运动状态，我们来看看下面的程序流程图就很清晰了：

1.2 实验流程图：

![](media/c74d8bfef83d370f3cec8201c85a676a.emf)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/49d2325fb4b9d0318e5c255d20c9ab2a.png)

2.  ![](media/2bd43822a990e75e17cd2517e0ae798e.png)

3.  ![](media/a897ef3edbed5013e9f47f657bb88336.png)

4.  ![](media/2df50e4c37f321d0448077d17bceab23.png)

5.  ![](media/3b5b9d9a9c763829fa725e5019a7e4f7.png)

6.  ![](media/3166f98330d301d67a208cb32364081e.png)

7.  ![](media/0bba03c9055acf3f4143d5123ce7a261.png)

8.  ![](media/d2344cc6e7d7e09a8afbdf37ca6c12ab.png)

9.  ![](media/352f188517c4095e1a7cbcc135d1d9ae.png)

1.3.2.完整的代码程序：

![](media/710523fb81f441c69b13713273bbd586.png)

![](media/b9fe3649df6dae76ca0ba8630581b68d.png)

1.4 实验结果：

上传代码成功后，将拨码开关拨到ON端上电，小车就能直线跟随了，注意这里只是直线跟随。我们用手掌放在超声波前面，慢慢向前，小车就会跟着我们的手掌移动。





## 第九课 超声波避障智能车

![](media/48cb81bec43c617bc34ff2e5abe7e2b4.jpg)

1.1 项目介绍：

在上个项目中，我们制作了一个超声波跟随智能车。实际上，利用同样的硬件，同样的接线方法，我们只需要更改一个测试代码就可以将跟随智能车变为避障智能车。超声波避障智能车，就是通过超声波传感器检测前方障碍物的距离，然后舵机云台转动检测到左右两边的距离，然后根据这一个数据控制四个电机的转动，从而控制智能车的运动状态，从而实现避障。

我们来看看下面的程序流程图就很清晰了：

1.2 实验流程图：

![](media/fba389b9f8eed3ac9822d0a732525657.emf)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/5a0145078b7b527ecf38a9e9de99c9f6.png)

2.  ![](media/cf9ff2d23357191fa904999c3b8c3fc0.png)

3.  ![](media/93cd7334b6bc9e658e503dc75955d1f4.png)

4.  ![](media/750f706d015d4e2711a8f5953f83f1dc.png)

5.  ![](media/25bec458ad27c8ad37c487d087ef3178.png)

6.  ![](media/124773cd73fffc7a6bfa551a6d48fd6f.png)

7.  ![](media/ddda8420545e69032f4546c19b7388dd.png)

8.  ![](media/ce099010829344ae91b8d00f89ce3b13.png)

9.  ![](media/f2c740937153428da13bc8c8fd9a2121.png)

10. ![](media/08f09717ec0133340edfa85aadf030f5.png)

1.3.2.完整的代码程序：

![](media/3aff5f5d6cca2d914b43e992e15b38f2.png)

![](media/004956fc43d890ee0e24bf279575f303.png)

1.4 实验结果：

上传代码成功后，将拨码开关拨到ON端上电，小车就能自动避障了，注意这里速度不要调得太大。当小车行驶过程中前方遇到障碍物，小车将停止，然后舵机云台转动到左边，测下左边的障碍物的距离；然后舵机云台转动到右边，测下右边的障碍物的距离，然后判断左边与右边障碍物的距离，那边更远，小车就往那边转弯，然后继续行驶。





## 第十课 红外接收

1.1 项目介绍：

![](media/ccfb1720370fb4aa9aa95b8105298a5c.png)毫无疑问，红外遥控在日常生活中随处可见，以至于很难想象没有它世界会变得怎样。它被用来控制各种家电，如电视、音响、录影机和卫星信号接收器。红外遥控是由红外发射和红外接收系统组成的，也就是一个红外遥控器和红外接收模块和一个能解码的单片机组成的。

红外接收我们用的是一个红外接收模块，主要由红外接收头组成，它是集接收、放大、解调一体的器件，它内部IC就已经完成了解调，能够完成从红外线接收到输出与TTL电平信号兼容的所有工作，输出的就是数字信号。接收器做成的红外接收模块只有三个引脚，信号线(由前面安装部分我们知道红外接收是与我们单片机的A3管脚相连的)，VCC，GND。与Keyes UNO PLUS开发板和其他单片机连接通信非常方便，我们这个实验就把红外遥控的键值打印到串口监视器上。

1.2 模块相关资料：

红外发射的遥控器发射的38KHz红外载波信号是由遥控器里的编码芯片对其进行编码。它是（NEC协议）以一段引导码，用户码，用户反码，数据码，数据反码组成，利用脉冲的时间间隔来区别是0还是1信号(560us低电平+560us高电平时被认为是信号0，560us低电平+1680us高电平时被认为是信号1)，而编码就是由这些0
、1信号组成。同一个遥控器的用户码是不变的，用数据吗不同来分辨遥控器按的键不同。当按下遥控器按键时，遥控器发送出红外载波信号，红外接收器接收到信号时程序对载波信号进行解码，通过数据码的不同来判断按下的是哪个键。单片机由接收到的01信号进行解码，由此判断遥控器按下的是什么键，为了方便接收数据，我们在小车前后都板载了红外接收头，我们这里是接到了Keyes UNO PLUS开发板的A3管脚。



![](media/aeadef74a7c7d84bafe08f1f42fa6417.png)



1.3 实验代码:

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/f81dfcdd917219bb653ad28fa21e24a3.png)

2.  ![](media/9d9c3be8c0a306395a882d372df8bd4a.png)

3.  ![](media/34f1e3be08efe8e985cf699d3d662599.png)

4.  ![](media/a79718092f0551504e3767e46f709e38.png)

1.3.2.完整的代码程序：

![](media/f80cc88bcf1a9db65181cf5dab9f0f17.png)

1.4 实验结果：

上传代码成功后，将拨码开关拨到ON端上电，在串口监视器窗口中点击![](media/7898923ed122a8589bb1df5e7bf8d210.png)设置波特率为9600，拿出遥控器，对准红外接收传感器发送信号，即可看相应按键的键值，如果按键时间过长，容易出现乱码。

![](media/7054dbe4a8b4e669543a98f731d2a80a.png)

我们通过测试得出的数值，做了一个遥控器按键值表，方便以后使用。

![](media/b5c753d6a1f5126fdd8e8423b82a836c.png)

1.5 项目拓展：使用一个OK键来控制七彩灯的亮灭

1.5.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/f81dfcdd917219bb653ad28fa21e24a3.png)

2.  ![](media/9d9c3be8c0a306395a882d372df8bd4a.png)

3.  ![](media/dc3d4a93b292b71eb0d1135f86e3249a.png)

4.  ![](media/34f1e3be08efe8e985cf699d3d662599.png)



5.  ![](media/e14cf0b6bcc3801e38189c9e892f46d5.png)

6.  ![](media/4d8a36006c44daf1e828b159109a6c35.png)

7.  ![](media/a18440d9755fb44e6986e6bd6a31a59d.png)

8.  ![](media/eb092e94fa066c759c27d73b33b28bde.png)

9.  ![](media/560059ac41d3dfe30c183c0268437cbb.png)

1.5.2.完整的代码程序：

![](media/bf7845d6c5fc8bb79d9206df71ae4535.png)

![](media/568a2382a23dce0e32ee67680de44244.png)

上传代码成功后，将拨码开关拨到ON端上电，当遥控器按下OK按键时,LED就会亮；再按一下OK按键时，LED就会灭。





## 第十一课 红外遥控智能车

![](media/6c4c7e1ec48694ae39fc068413751973.jpg)

1.1 项目介绍：

前面我们已经测试出红外遥控器各个按键对应的键值，这个项目我们就是使用红外遥控器来控制小车了，我们可以通过代码设置（键值），让对应的按键控制智能车对应的运动状态。

1.2 实验流程图：

![](media/a4b4c94ba4cfcc4599e70371a5637c4a.emf)

1.3 实验代码：

1.3.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/8a8d51c578c84b8e9c3c7fe45f29cb84.png)

2.  ![](media/7612ba4d3e8a744ca3af434bb2914aa6.png)

3.  ![](media/2609a48b71188bddd4ba5d5c4eee3397.png)

4.  ![](media/34f1e3be08efe8e985cf699d3d662599.png)

5.  ![](media/010a7f164a4755972f8b55f5bcecf54f.png)

6.  ![](media/a18440d9755fb44e6986e6bd6a31a59d.png)

7.  ![](media/b5335bcbcb1c7cf8dc0324d7340550c7.png)

1.3.2.完整的代码程序：

![](media/245d5b2969eefd09c942d42f76474477.png)

![](media/76c264fcccd9d27815bbabd96ddd290f.png)

1.4 实验结果：

上传代码成功后，将拨码开关拨到ON端上电，当我们按下遥控器上的![](media/fee67ed1a9ebeca9e3d4c73af92321f1.png)时，小车前进；当我们按下遥控器上的![](media/9f1ed9d53c1bb73d472dd57f4e25fd1b.png)时，小车左转；当我们按下遥控器上的![](media/de213abdf4bc48c2c0f4ca3b9ff51f1b.png)时，小车后退；当我们按下遥控器上的![](media/0c707a4f97ab0e9934f03938533408eb.png)时，小车右转；当我们按下遥控器上的![](media/32078092fc089e2716222221f4b4c541.png)时，小车停止。





## 第十二课 蓝牙APP控制麦轮车

![](media/f1647527e7b76cf69e343ddda1d3b68c.jpg)

1.1. 项目介绍：

![](media/e196d876d3e9584ad5bb59da78a1bd1e.jpg)我们这个套件中有一个DX-BT24 5.1蓝牙模块，这个款蓝牙模块配置
256Kb 空间，遵循 V5.1 BLE蓝牙规范。支持AT指令，用户可根据需要更改串口波特率、设备名称等参数，使用灵活。支持UART接口，并支持蓝牙串口透传，
具有成本低、体积小、功耗低、收发灵敏性高等优点，只需配备少许的外围元件就能实现其强大功能。

在前面课程中，我们只是基本让该套件的模块/传感器实现单个功能，那我们能不能把所有功能合在一起呢？当然可以，在这一课程中，我们使用BT24蓝牙模块用一个代码把小车所有模块都结合起来，这里包含前面课程中讲到的除了红外遥控的所有功能，我们利用手机APP连接蓝牙模块，从而操控各种功能，简单方便。我们先通过APP连接蓝牙来读取APP界面上各按钮发送的控制字符。

1.2. 模块相关资料：

蓝牙协议：Bluetooth Specification V5.1 BLE

工作频率：2.4GHz ISM band

通信接口：UART

供电电源：5V/3.3V

通信距离:40m

外观尺寸：27(L)mm x 13 (W)mm x 2(H) mm

蓝牙名称：BT24

串口参数：9600、8数据位、1停止位、无校验、无流控

工作温度：MIN:-40℃ - MAX:+85℃

DX-BT24模块同时支持 BT5.1 BLE 协议，可以同具备 BLE
蓝牙功能的 iOS 设备直
接连接，支持后台程序常驻运行。主要用于短距离的数据无线传输领域。避免繁琐的线缆
连接，能直接替代串口线。BT24 模块成功应用领域：

※ 蓝牙无线数据传输； ※ 手机、电脑周边设备； ※ 手持
POS 设备；

※ 医疗设备无线数据传输； ※ 智能家居控制； ※
蓝牙打印机；

※ 蓝牙遥控玩具； ※ 共享单车；

蓝牙接口说明：

![](media/cd97cf79ff5cdd5bbd78f4cc960d38e5.png)①STATE：状态脚

②RX：接收脚

③TX：发送脚

④GND：接地脚

⑤VCC：电源脚

⑥EN：使能脚

将蓝牙模块连接到开发板：

<table>
<colgroup>
<col />
<col />
</colgroup>
<tbody>
<tr>
<td>Uno</td>
<td>BT24</td>
</tr>
<tr>
<td>TX</td>
<td>RX</td>
</tr>
<tr>
<td>RX</td>
<td>TX</td>
</tr>
<tr>
<td>VCC</td>
<td>5V</td>
</tr>
<tr>
<td>GND</td>
<td>GND</td>
</tr>
</tbody>
</table>

### 1.3 APP: 

有关APP的具体下载安装方法及使用方法，请参考文件夹“7. APP”。

![](media/ad21b94facdf9c3125400d646912ef1b.png)

1.4 实验代码：

1.4.1.寻找代码块：

也可以自己通过拖动代码块来编写代码程序，寻找代码块如下：

1.  ![](media/c10b268ffa4f01321c3004bc33a2c68f.png)

2.  ![](media/9e89f5f51e0dd3da9e416575e38cd594.png)

3.  ![](media/8f6a48d4a407633ca65a1be03aef29c2.png)

4.  ![](media/9b9d5cbc18fc81cf05eb64119b656302.png)

5.  ![](media/4c474e54cc0052c451e2a3c480cfed5b.png)

1.4.2.完整的代码程序：

![](media/0bdfeb7baf905d16a76aa34c7b93231e.png)

1.5. 实验结果：

上传代码完成后，插上蓝牙，注意蓝牙不要插反了。连接蓝牙模块和打开串口监视器，对准蓝牙模块按下手机APP按钮，我们可以看到APP按钮对应的控制字符，如下图。

注意：蓝牙模块的RXD、TXD、GND、VCC分别对应的接到 电机驱动扩展板上的TX、RX、G、5V，而蓝牙模块的STATE和BRK两引脚不需要接。蓝牙是直接插在电机驱动扩展板上的，注意一下方向，而且在上传代码之前不要插上蓝牙模块。

![](media/838bc9b4724cd3a560fc8d054cdf6621.png)

1.6. 综合项目：APP控制麦克纳姆轮智能车

由于这个代码程序比较复杂，代码块非常多，这里我们就不提供编写代码程序所需寻找代码块的过程，如果你自己有兴趣的话，可以自己拖动代码块来操作下。

1.6.1.完整的代码程序：

![](media/21bb952c36f6b6c5d9adb1ea02b7dd4d.png)

烧入代码后，将拨码开关拨到ON端上电，我们连上蓝牙BT24，就可以使用手机APP来控制我们前面所学的一系列玩法了：

1.  点击![](media/9e74ac7cb7424cb3cc9a330c9664aaa6.png)开启七彩灯，再次点击这个按钮七彩灯就会关闭。

2.  点击![](media/0e95b34cb9787a65450ac7de99250259.png)会进入循迹模式，当想退出该模式时，再次点击该按钮。

3.  点击![](media/36671fadc495bf97554a7e945479e11b.png)会进入跟随模式、当想退出该模式时，再次点击该按钮。

4.  点击![](media/f28f956c8261bfd8f6ec9afd9bfa78ce.png)会进入避障模式，当想退出该模式时，再次点击该按钮。

5.  ![](media/00adc835c0a15a08e21601b06128b916.png)拉动这两个条幅回改变左边两个电机的速度，右边也是相同的操作方法。

6.  ![](media/2ce2f1ff48f8de83ec3a3b54303e47f9.png)这几个按钮是用来切换底板下面4个2812灯珠颜色的，中间按钮为关闭功能。

7.  剩下其他的按钮全都是用来操控小车行驶的，跟其他按钮不同的是，这些按钮当我们按下时小车行驶，松开按钮时小车停止。

![](media/c68498698c5d045a24ce3b784a5b3a70.jpg)





